

pipeline{
    agent any

    environment {
        Map accounts = [
            "dev"     : "179438333696",
            "prod"    : "179438333696"
        ]
        Map clusters = [
            "dev"     : "Devcluster",
            "prod"    : "Experta_Prod"
        ]
        AWS_DEFAULT_REGION = 'us-east-1'
        AWS_ACCOUNT_ID = '179438333696'
        REPOSITORY_URI = "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com"
        DOCKER_IMAGE_TAG_PROGRAM = "${REPOSITORY_URI}/program-service:latest"
        AWS_ECR_REPO = "program-service"
        ECS_SERVICE = "Programservice"
        SNS_TOPIC_ARN = "arn:aws:sns:${AWS_DEFAULT_REGION}:${AWS_ACCOUNT_ID}:jenkins"
    }

    // options([
    //     parameters ([
    //             choice(name: 'ENVIRONMENT',
    //                     choices: ['none'] + ['dev', 'prod'] ,
    //                     description: 'Environment to deploy',)
    //     ]),
    //     [$class: 'BuildDiscarderProperty', strategy: [$class: 'LogRotator', artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '', numToKeepStr: '100']]
    // ])

    parameters {
        choice(name: 'ENVIRONMENT', choices: ['DEV', 'Production'], description: 'Environment')
    }

    tools {
        maven 'maven' // Define Maven tool installation
    }

    stages {

        stage('Git Checkout') {
            AWS_ACCOUNT_ID = accounts.get(params.ENVIRONMENT)
            ECS_CLUSTER = clusters.get(params.ENVIRONMENT)
            steps {
                script {
                    sh """
                    echo 'Hi there'
                    echo 'params.BUILD_ENV = ${params.ENVIRONMENT}'
                    echo 'BUILD_ENV        = ${ENVIRONMENT}'
                    echo 'BUILD_NUMBER     = ${BUILD_NUMBER}'
                    echo 'BRANCH_NAME     = ${BRANCH_NAME}'
                    echo 'AWS_ACCOUNT_ID     = ${AWS_ACCOUNT_ID}'
                    echo 'ECS_CLUSTER     = ${ECS_CLUSTER}'
                    echo 'automatic trigger....'
                    """
                    // git branch: BRANCH_NAME, url: 'https://github.com/snagurum/nhd.git'
                }
            }
        }
        stage('Checkout SCM') {
            steps{
                sh """
                    echo 'Hi there'
                """
                checkout scm
            }   
            
        }
    }    
}